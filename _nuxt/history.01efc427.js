import{V as _,u as h,_ as T}from"./VSnackbar.8c13c53e.js";import{d as y,r as i,b as g,y as S,j as k,k as C,m as u,z as r,q as D,s as V,t as b,A as x,B}from"./entry.e5a10ea8.js";import{u as N}from"./vue.f36acd1f.79073c76.js";import{H as F}from"./viewer-config.e92aff90.js";import"./variant.200e217a.js";const R=y({__name:"history",setup($){const t=F(),d=B();N({title:"BiliSC",titleTemplate:`${t.room} - %s`});let a;const o=i([]),s=i(!1),n=i("Error");g(()=>m()),S(()=>t.startFetch,e=>{e?f():m()});async function f(){t.room&&(console.log("startFetchData"),await c(),a&&clearTimeout(a),p())}function p(){const e=async()=>{await c(),a=setTimeout(e,8e3)};a=setTimeout(e,8e3)}async function c(){if(!(!t.room||isNaN(Number(t.room))||t.room===""))try{const e=await h(d.public.BASE_API_URL+"/sc/getDataByTS",{method:"POST",body:`roomid=${t.room}&start=${t.startTS}&end=${t.endTS}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}},"$XOLOw0smvH");o.value=e.data,console.log(o)}catch(e){s.value=!0,e.response!==void 0&&e.response.data!==void 0?n.value=e.message+`
`+e.response.data:n.value=e.name+": "+e.message,console.warn(e)}}function m(){a&&clearTimeout(a),a=void 0,o.value=[]}return(e,l)=>{const v=T;return k(),C("div",null,[u(v,{rawscdata:r(o).value,showmarknative:r(t).showMarkNative},null,8,["rawscdata","showmarknative"]),u(_,{modelValue:r(s),"onUpdate:modelValue":l[0]||(l[0]=w=>x(s)?s.value=w:null)},{default:D(()=>[V(b(r(n)),1)]),_:1},8,["modelValue"])])}}});export{R as default};
