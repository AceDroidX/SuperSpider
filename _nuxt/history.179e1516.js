import{V as _,u as h,_ as T}from"./VSnackbar.cfbcdccb.js";import{d as g,j as y,r as i,b as C,z as S,k,l as D,q as u,A as r,s as V,v as b,t as x,B,C as N}from"./entry.d2b400e9.js";import{H as F}from"./viewer-config.cff30422.js";import"./variant.1f848ebd.js";const O=g({__name:"history",setup($){const a=F(),d=N();y({title:"BiliSC",titleTemplate:`${a.room} - %s`});let t;const o=i([]),s=i(!1),n=i("Error");C(()=>l()),S(()=>a.startFetch,e=>{e?f():l()});async function f(){a.room&&(console.log("startFetchData"),await c(),t&&clearTimeout(t),p())}function p(){const e=async()=>{await c(),t=setTimeout(e,8e3)};t=setTimeout(e,8e3)}async function c(){if(!(!a.room||isNaN(Number(a.room))||a.room===""))try{const e=await h(d.public.BASE_API_URL+"/sc/getDataByTS",{method:"POST",body:`roomid=${a.room}&start=${a.startTS}&end=${a.endTS}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}},"$XOLOw0smvH");o.value=e.data,console.log(o)}catch(e){s.value=!0,e.response!==void 0&&e.response.data!==void 0?n.value=e.message+`
`+e.response.data:n.value=e.name+": "+e.message,console.warn(e)}}function l(){t&&clearTimeout(t),t=void 0,o.value=[]}return(e,m)=>{const v=T;return k(),D("div",null,[u(v,{rawscdata:r(o).value,showmarknative:r(a).showMarkNative},null,8,["rawscdata","showmarknative"]),u(_,{modelValue:r(s),"onUpdate:modelValue":m[0]||(m[0]=w=>B(s)?s.value=w:null)},{default:V(()=>[b(x(r(n)),1)]),_:1},8,["modelValue"])])}}});export{O as default};
