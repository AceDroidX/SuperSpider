import n from"./SCList.32c06fd2.js";import{a as m,b as h,o as c,e as u,f as r,w as l,h as d,t as p}from"./entry.2cf9485d.js";import{u as f,V as k}from"./VSnackbar.00f8e4b5.js";import"./SuperChat.312a1639.js";import"./VContainer.64b1ec6b.js";import"./tag.7f81d670.js";import"./router.295f1ffd.js";import"./color.f22f3f2e.js";import"./position.9ad51159.js";import"./forwardRefs.115f55a5.js";import"./transition.c1879f42.js";const w={name:"MiniSCViewer",data(){return{rawSCData:[],started:!1,timer:!1,addText:"",fontStyle:"",snackbar:!1,snackbarText:"Error"}},head(){return{title:"BiliSC(mini)",titleTemplate:`${this.room} - %s`}},computed:{room(){return isNaN(parseFloat(this.$route.query.room))?21452505:parseFloat(this.$route.query.room)},showMarkNative(){return this.$route.query.mark?this.$route.query.mark==="true":!0},pageLimit(){return isNaN(parseFloat(this.$route.query.limit))?100:parseFloat(this.$route.query.limit)},dark(){return this.$route.query.dark?this.$route.query.dark==="true":!0}},watch:{startFetch(){this.startFetch&&this.startFetchData()},snackbarText(t,e){console.log(t,e)},snackbar(t,e){console.log(t,e)}},async mounted(){this.$vuetify.theme.global.name=this.dark?"dark":"light",this.room&&this.room!==""&&await this.startFetchData()},beforeDestroy(){this.timer&&clearTimeout(this.timer)},methods:{async startFetchData(){this.room&&(console.log("startFetchData"),await this.fetchData().catch(()=>{}),this.started!==this.room&&(this.timer&&clearTimeout(this.timer),this.setTimeoutLoop(),this.started=this.room))},setTimeoutLoop(){const t=async()=>{await this.fetchData().catch(()=>{}),this.timer=setTimeout(t,8e3)};this.timer=setTimeout(t,8e3)},async fetchData(){if(!(!this.room||isNaN(Number(this.room))||this.room===""))try{const t=h(),e=await f(t.BASE_API_URL+"/sc/getData",{method:"POST",body:`roomid=${this.room}&limit=${this.pageLimit}${this.giftFilterNative?"&filter=on":""}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}},"$67H8BpJnsy");this.rawSCData=e.data}catch(t){this.snackbar=!0,t.response!==void 0?t.response.data!==void 0?this.snackbarText=t.message+`
`+t.response.data:this.snackbarText=t.name+": "+t.message:this.snackbarText=t.name+": "+t.message,console.warn(t)}}}};function y(t,e,b,T,a,s){const i=n;return c(),u("div",null,[r(i,{rawscdata:a.rawSCData,showmarknative:s.showMarkNative},null,8,["rawscdata","showmarknative"]),r(k,{modelValue:a.snackbar,"onUpdate:modelValue":e[0]||(e[0]=o=>a.snackbar=o)},{default:l(()=>[d(p(a.snackbarText),1)]),_:1},8,["modelValue"])])}const v=m(w,[["render",y]]);export{v as default};
