import{V as w,_ as h,u as T}from"./CVk5FFF2.js";import{H as y}from"./B1VobMGF.js";import{d as C,r as i,e as g,I as S,x as k,B as l,G as r,C as D,H as x,y as V,D as B,A as b,n as N}from"./Ce15lXcl.js";import{u as F}from"./BMUuKLY5.js";import"./Dzlx3iFJ.js";const P=C({__name:"history",setup(H){const a=y(),d=N();F({title:"BiliSC",titleTemplate:`${a.room} - %s`});let t;const o=i([]),s=i(!1),n=i("Error");g(()=>m()),S(()=>a.startFetch,e=>{e?f():m()});async function f(){a.room&&(console.log("startFetchData"),await c(),t&&clearTimeout(t),p())}function p(){const e=async()=>{await c(),t=setTimeout(e,8e3)};t=setTimeout(e,8e3)}async function c(){if(!(!a.room||isNaN(Number(a.room))||a.room===""))try{const e=await T(d.public.BASE_API_URL+"/sc/getDataByTS",{method:"POST",body:`roomid=${a.room}&start=${a.startTS}&end=${a.endTS}`,headers:{"Content-Type":"application/x-www-form-urlencoded"}},"$IkCHW8M_Pu");o.value=e.data,console.log(o)}catch(e){s.value=!0,e.response!==void 0&&e.response.data!==void 0?n.value=e.message+`
`+e.response.data:n.value=e.name+": "+e.message,console.warn(e)}}function m(){t&&clearTimeout(t),t=void 0,o.value=[]}return(e,u)=>{const _=h;return V(),k("div",null,[l(_,{rawscdata:r(o).value,showmarknative:r(a).showMarkNative},null,8,["rawscdata","showmarknative"]),l(w,{modelValue:r(s),"onUpdate:modelValue":u[0]||(u[0]=v=>x(s)?s.value=v:null)},{default:D(()=>[B(b(r(n)),1)]),_:1},8,["modelValue"])])}}});export{P as default};
